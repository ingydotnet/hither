=pod

=for comment
DO NOT EDIT. This Pod was generated by Swim v0.1.39.
See http://github.com/ingydotnet/swim-pm#readme

=encoding utf8

=head1 Name

hither - Database Munging Swiss Army Chainsaw

=for html
<a href="https://travis-ci.org/ingydotnet/hither"><img src="https://travis-ci.org/ingydotnet/hither.png" alt="hither"></a>

=head1 Synopsis

    # Load a sample Postgres database
    > hither --in=http://www.commandprompt.com/ppbook/booktown.sql \
             --out=pg://localhost/booktown

    # Generate a Hither Schema Definition
    > hither --in=pg://localhost/booktown --out=schema1.hsd

    # Generate a Hither Migration Definition
    > hither --in=schema1.hsd --in=schema2.hsd --out=migrate-1-2.hmd

    # Generate an SQL file for a migration
    > hither --in=migrate-1-2.hmd --out=migrate-1-2.sql

    # Apply a hither migration to a database
    > hither --in=migrate-1-2.hmd --out=pg://localhost/booktown

=head1 Description

Hither is a generic database manipulation tool. It does complicated and
annoying database operations in simple and consistent manners.

Hither considers a database to be in a given "state". The state is effectively
the database's schema. Hither assigns an id to a state. A schema migration is
simply going from one state to another state. Hither keeps the current state
id in a table (called C<hither> by default). This table also keeps track of
the past migrations that have taken place.

The migration logic between 2 states is specified by a Hither Migration
Definition file. This file contains all the information to go from state A to
state B, and also from state B to state A (reverse migration). Hither tries
hard to generate as much of the HMD as it can, but requires human
attention/modification for certain operations.

Using this information, hither can (in theory) migrate database schemas
between any 2 states. When it doesn't have enough information to do that, it
will ask for the missing parts.

Development projects (codebases) that use a database, need the database to be
in a certain state. It may be the case that multiple dev teams are working on
multiple branches that each need a different state. This is where Hither is of
huge benefit. The codebase should identify (in code or config) the state it
requires. If the Hither state of the database is different than the state that
the code wants, the codebase should refuse to connect to it, and give an error
message telling the user the 2 states (codebase and database). Then the user
can simply use Hither to migrate.

=head1 Installation

Installing Hither is a simple as cloning its git repository and adding its
C<bin/> directory to your C<PATH>:

    git clone git@github.com:ingydotnet/hither
    export PATH="$PWD/hither/bin:$PATH"

However, Hither currently has a lot of dependencies:

Languages, and packages:

=over

=item * Bash

=item * CoffeeScript

=item * Node.js

=over

=item * crypto

=item * js-yaml

=item * pg-json-schema-export

=back

=item * Perl

=over

=item * DBIx::Class::Schema::Loader

=item * SQL::Translator

=item * Template::Toolkit::Simple

=item * YAML::XS

=back

=item * Python

=over

=item * Django

=back

=back

Databases:

=over

=item * PostgreSQL

=item * MySQL

=item * SQLite

=back

Since Hither is still in early development, it is left up to you to install
these things. :)

=head2 Support and Functionality

Hither tries to be a general tool, helping with many common operations on many
popular databases. The following sections, list the current support level:

=head2 Supported Databases

=over

=item * PostgreSQL

=item * MySQL

=item * SQLite

=back

=head2 Supported Dataset Sources

=over

=item * Databases listed above

=item * SQL dumps

=item * CSV and TSV files

=item * Hither fixture files (YAML)

=back

=head2 Supported I/O

=over

=item * File URLs (input only)

=item * Database conninfo URLs

=item * Disk file paths

=item * STDIN / STDOUT

=back

=head2 Supported Operations

=over

=item * Load database from database source

=item * Dump database to various formats

=item * Extract database schema to HSD (Hither Schema Definition)

=item * Generate migration (HMD) files from 2 HSDs

=item * Generate SQL migration files from HMD files

=item * Apply a migration to a database (and update the C<hither> table)

=back

=head1 Command Line Usage

Hither provides a single command line tool called C<hither> that does all
hither activities. The usage is:

    hither <options>

=head2 C<hither> Options

Hither is mostly concerned with transforming a data source in a given
format (input), to a data target in another format (output). The primary
options are thus:

=over

=item C<--input=> C<-i>

The input data source. Can be a database, file, URL or STDIN.

=item C<--output> C<-o>

The output data target. Can be a database, file, URL or STDOUT.

=back

Hither supports a database connection info URL for C<--input> and C<--output>.
See "Hither Connection URLs" below.

Closely related are the options that say what format the data is in. Many
times this is inferred from the file extension, or URL scheme but other times
(such as using STDIN/STDOUT) you need to specify the format explicitly with
these options:

=over

=item C<--from> C<-f>

The data format of the input. Things like C<csv>, C<pg> (postgresql), C<sql>,
C<hsd>, C<hmd>, etc.

=item C<--to> C<-t>

The data format of the output. Things like C<csv>, C<pg>, C<sql>, C<hsd>,
C<hmd>, etc.

=back

Each invocation of a C<hither> command performs a single transformation. For
instance C<sql-to-pg> would load a PostgreSQL database from an SQL dump text.
This is called an "action", and this particular action would be performed by
an external program called C<hither-sql-to-pg>.

The B<action> is almost always inferred from the B<options>, but these options
are sometimes needed:

=over

=item C<--action> C<-a>

Specify an action explicitly. All actions are described below:

=item C<--with> C<-w>

In some cases an operation has multiple implementations. For instance the
C<sql-to-pg> might have 2 implementations, one that uses C<psql> and one
that uses C<perl>. The option C<--with=perl> would execute the program:
C<hither-sql-to-pg-with-perl>.

=back

There are a 2 options that specify the location of extra information needed by
some action commands:

=over

=item C<--profile> C<-p>

The C<hither> command puts all of its information in environment variables
before executing the action program. The C<--profile> option points to a bash
file that is sourced; usually exporting C<HITHER_*> environment variables
containing things like the database user and password. (These variables are
described below.)

=item C<--metadata> C<-m>

Points to a YAML or JSON file that contains extra data needed by some actions.

=back

Finally, C<hither> has 3 options for contralling its command output:

=over

=item C<--quiet> C<-q>

Run in quiet mode. No output, except for errors.

=item C<--verbose> C<-v>

Be more noisy. Show what steps are happening during execution.

=item C<--debug> C<-D>

Spew tons of debug info. Usually turns on Bash's C<set -x> option, which
prints every instruction before executing it.

=back

=head2 Hither Connection URLs

To connect to a database, you often need to specify theses things:

=over

=item * Database Type

=item * Server Address

=item * Server Port

=item * Database Name

=item * User Name

=item * User Password

=back

Hither supports a URL format that allows one to say all this in one string:

    type://user:password@server:port/dbname#opt1=val1;opt2=val2...

For example:

    pg://nate:pa55w0rd@localhost:5432/baseball_stats

When some values are specified elsewhere, parts can be left out. Only C<type>,
C<address> and C<dbname> are required:

    pg://localhost/baseball_stats

=head2 C<hither> Actions

=over

=item C<hsd-to-django>

Generate a Django C<models.py> class/model file from an HSD.

=item C<pg-to-hsd>

Create an HSD file from a Postgres DB schema. Defaults to the C<node>
implementation.

=item C<pg-to-hsd-with-node>

Create an HSD file from a Postgres DB schema, using a node.js library.

=item C<pg-to-hsd-with-dbic>

Create an HSD file from a Postgres DB schema, using Perl's
DBIx::Class::Schema::Loader.

=item C<pg-to-dbic>

Create a set of DBIx::Class models from a Postgres DB.

=item C<sql-to-pg>

Load a Postgres DB from an SQL source file or URL. Will drop the DB first, if
it exists.

=back

=head2 The C<HITHER_*> Environment Variables

The C<hither> command sets these environment variables before executing its
action program. Most of these variables are either hither option overrides or
database connection information, like C<user>i, C<password> and C<dbname>.

The C<hither> command will use these variables if thy are already in the
environment, or else the user can supply the information as command options,
and C<hither> will add them to the environment before executing the command.

=over

=item C<HITHER_ACTION>

The B<action> verb, like C<sql-to-pg>.

=item C<HITHER_DBNAME>

The name of the database being accessed. For SQLite, this would be the name of
the database file without the file extension.

=item C<HITHER_DEBUG>

Environment variable for C<--debug> option.

=item C<HITHER_FROM>

Environment variable for C<--from=> option.

=item C<HITHER_IN>

Hither input data source file or URL.

=item C<HITHER_METADATA>

Environment variable for C<--metadata> option.

=item C<HITHER_OUT>

Hither output data source file or URL.

=item C<HITHER_PASSWORD>

The database user's password.

=item C<HITHER_PORT>

The port number that the database server is listening on.

=item C<HITHER_PROFILE>

A bash file to be sourced, usually containing exports of environment
variables.

=item C<HITHER_QUIET>

Environment variable for C<--quiet> option.

=item C<HITHER_SERVER>

The database server's IP address.

=item C<HITHER_TO>

Environment variable for C<--to=> option.

=item C<HITHER_TYPE>

The database type: C<pg> (Postgres), C<my> (MySQL) or C<lite> (SQLite).

=item C<HITHER_USER>

The user name being used to access a database with user authentication.

=item C<HITHER_VERBOSE>

Environment variable for C<--verbose> option.

=back

=head1 Contribute

Hither is an Open Source project. It is hosted on
L<GitHub|https://github.com/ingydotnet/hither>. It has the IRC channel
C<#hither> on irc.freenode.net.

If you are interested in contributing, you know the drill. :)

=head1 See Also

=over

=item * L<Hither Specification|https://github.com/ingydotnet/hither/blob/master/doc/pod/Spec.pod>

=back

=head1 Copyright & License

Copyright 2015. Ingy döt Net.

The MIT License (MIT)

=cut
